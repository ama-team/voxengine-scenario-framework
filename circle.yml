machine:
  post:
    - sudo apt-add-repository ppa:yandex-qatools/allure-framework -y
    - sudo apt-get update -yq
    - sudo apt-get install allure-commandline -yq
general:
  artifacts:
    - report/allure
    - report/coverage
    - report/xunit.xml
test:
  override:
    - 'npm run test:report'
    - 'npm run test:coverage'
  post:
    - mkdir -p $CIRCLE_TEST_REPORTS/junit
    - cp report/xunit.xml $CIRCLE_TEST_REPORTS/junit/test-results.xml
deployment:
  npm-release:
    tag: /^\d+\.\d+\.\d+$/
    owner: ama-team
    commands:
      - node_modules/.bin/npm-cli-login
      - npm publish --access public
